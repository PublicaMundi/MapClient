!function(e,t){"use strict";"undefined"!=typeof t&&(t.define("PublicaMundi.OpenLayers"),t.OpenLayers.Framework="ol",t.registerFrameworkResolver(t.OpenLayers.Framework,function(){return t.isObject(ol)&&t.isFunction(ol.Map)?!0:!1}))}(window,PublicaMundi),ol.control.LayerSwitcher=function(e){var t=e||{};this.mapListeners=[],this.hiddenClassName="ol-unselectable ol-control layer-switcher",this.shownClassName=this.hiddenClassName+" shown";var n=document.createElement("div");n.className=this.hiddenClassName;var r=document.createElement("button");n.appendChild(r),this.panel=document.createElement("div"),this.panel.className="panel",n.appendChild(this.panel);var i=this;n.onmouseover=function(e){i.showPanel()},r.onclick=function(e){i.showPanel()},n.onmouseout=function(e){e=e||window.event,n.contains(e.toElement)||i.hidePanel()},ol.control.Control.call(this,{element:n,target:t.target})},ol.inherits(ol.control.LayerSwitcher,ol.control.Control),ol.control.LayerSwitcher.prototype.showPanel=function(){this.element.className!=this.shownClassName&&(this.element.className=this.shownClassName,this.render())},ol.control.LayerSwitcher.prototype.hidePanel=function(){this.element.className!=this.hiddenClassName&&(this.element.className=this.hiddenClassName)},ol.control.LayerSwitcher.prototype.render=function(){for(;this.panel.firstChild;)this.panel.removeChild(this.panel.firstChild);var e=document.createElement("ul");this.panel.appendChild(e),this.renderLayers_(this.getMap(),e)},ol.control.LayerSwitcher.prototype.setMap=function(e){for(var t=0;t<this.mapListeners.length;t++)this.getMap().unByKey(this.mapListeners[t]);this.mapListeners.length=0,ol.control.Control.prototype.setMap.call(this,e);var n=this;this.mapListeners.push(e.on("pointerdown",function(){n.hidePanel()})),this.render()},ol.control.LayerSwitcher.prototype.toggleLayer_=function(e){var t=this.getMap();e.setVisible(!e.getVisible()),"base"===e.get("type")&&ol.control.LayerSwitcher.forEachRecursive(t,function(t,n,r){"base"===t.get("type")&&t!=e&&t.setVisible(!1)})},ol.control.LayerSwitcher.prototype.renderLayer_=function(e,t){var n=this,r=document.createElement("li"),i=e.get("title"),s=e.get("title").replace(" ","-")+"_"+t,o=document.createElement("label");if(e.getLayers){r.className="group",o.innerHTML=i,r.appendChild(o);var u=document.createElement("ul");r.appendChild(u),this.renderLayers_(e,u)}else{var a=document.createElement("input");"base"===e.get("type")?(a.type="radio",a.name="base"):a.type="checkbox",a.id=s,a.checked=e.get("visible"),a.onchange=function(){n.toggleLayer_(e)},r.appendChild(a),o.htmlFor=s,o.innerHTML=i,r.appendChild(o)}return r},ol.control.LayerSwitcher.prototype.renderLayers_=function(e,t){for(var n,r=e.getLayers().getArray().slice().reverse(),i=0;i<r.length;i++)n=r[i],n.get("title")&&t.appendChild(this.renderLayer_(n,i))},ol.control.LayerSwitcher.forEachRecursive=function(e,t){e.getLayers().forEach(function(e,n,r){t(e,n,r),e.getLayers&&ol.control.LayerSwitcher.forEachRecursive(e,t)})},function(e,t,n){"undefined"!=typeof t&&"undefined"!=typeof n&&(t.define("PublicaMundi.OpenLayers"),t.OpenLayers.Map=t.Class(t.Map,{addOverlay:function(e){return popup=new n.Overlay({element:e}),this._map.addOverlay(popup),popup},getOverlayElement:function(e){return e.getElement()},setOverlayPosition:function(e,t){e.setPosition(t)},setExtent:function(e,t){if(null!==e){var r;"EPSG:4326"==t?(e[0]<-180&&(e[0]=-179),e[1]<-90&&(e[1]=-89),e[2]>180&&(e[2]=179),e[3]>90&&(e[3]=89),r=n.proj.transformExtent(e,"EPSG:4326","EPSG:3857")):r="EPSG:3857"==t?e:null,this._map.getView().fitExtent(r,this._map.getSize())}},initialize:function(e){if(t.Map.prototype.initialize.call(this,e),t.isClass("ol.Map")&&e instanceof n.Map?this._map=e:this._map=new n.Map({target:e.target,view:new n.View({projection:e.projection,center:e.center,zoom:e.zoom,maxZoom:e.maxZoom,minZoom:e.minZoom}),controls:n.control.defaults({rotate:!1}).extend([]),interactions:e.interactions,ol3Logo:!1}),e.layerControl&&this.setLayerControl(),this._listen(),this._clickHandlerMap=null,this._clickHandlerLayer=[],this._clickHandlerRegisteredLayers=[],this._map.on("click",function(e){}),"undefined"!=typeof e.layers&&t.isArray(e.layers))for(var r=0;r<e.layers.length;r++)this.createLayer(e.layers[r])},setCenter:function(e,n){t.isArray(e)?this._map.getView().setCenter(e):this._map.getView().setCenter([e,n])},getCenter:function(){return this._map.getView().getCenter()},setZoom:function(e){this._map.getView().setZoom(e)},getZoom:function(){return this._map.getView().getZoom()},getProjection:function(){return this._map.getView().getProjection().getCode()},getTarget:function(){return this._map.getTarget()},addLayer:function(e){this._map.addLayer(e.getLayer());var r=t.helpers();if(t.isFunction(e.getOptions().click)&&(this._clickHandlerRegisteredLayers.push(e),this._clickHandlerLayer.push(e.getOptions().click),this._featureOverlay=new n.FeatureOverlay({map:this._map}),!t.isFunction(this._clickHandlerMap))){var i=this._clickHandlerRegisteredLayers,s=this._clickHandlerLayer,o=this._map,u=this;this._clickHandlerMap=function(e){var n=this._map.getEventPixel(e.originalEvent),a=[];o._highlight&&(u._featureOverlay.removeFeature(o._highlight),o._highlight=void 0);for(var f=function(e,n){if(n===i[l].getLayer()&&n.get("visible")===!0){var s=i[l],f=s._style,c=null;t.isFunction(f.highlight)?u._featureOverlay.setStyle(f.highlight):(c=r._transformStyle(f.highlight),u._featureOverlay.setStyle(c)),o._highlight?o._highlight!==e&&(u._featureOverlay.removeFeature(o._highlight),o._highlight=e,u._featureOverlay.addFeature(e)):(o._highlight=e,u._featureOverlay.addFeature(e));for(var h={},p=e.getKeys(),d=e.getGeometryName(),v=0;v<p.length;v++)p[v]!==d&&(h[p[v]]=e.get(p[v]));a.push(h)}},l=0;l<i.length;l++)a=[],this._map.forEachFeatureAtPixel(n,f),a.length>0&&s[l](a,e.coordinate)},this._map.on("singleclick",this._clickHandlerMap,this)}},removeLayer:function(e){if(e){this._map.removeLayer(e.getLayer());for(var t=0;t<this._layers.length;t++)if(this._layers[t]==e){this._layers.splice(t,1);break}}},setLayerControl:function(e){return this._control=new n.control.LayerSwitcher,this._map.getControls().extend([this._control]),this._control},_setViewBox:function(){var e=this.getExtent()[0]+","+this.getExtent()[1]+","+this.getExtent()[2]+","+this.getExtent()[3];this._viewbox=e},getExtent:function(){return this._map.getView().calculateExtent(this._map.getSize())},_listen:function(){var e=this;this._map.on("moveend",function(){e._setViewBox()})}}),t.locator.register("PublicaMundi.Map",t.OpenLayers.Map))}(window,window.PublicaMundi,ol),function(e,t){"undefined"!=typeof t&&(t.define("PublicaMundi.OpenLayers.Helpers"),t.OpenLayers.Helpers=t.Class(t.Helpers,{initialize:function(){},_getDefaultStyle:function(e,t){if(!e&&!t)return{};var n={};return n.color=e.color||t.color||"rgba(0,255,0)",n.opacity=e.opacity||t.opacity||1,n.fillColor=e.fillColor||t.fillColor||"rgba(255,255,0)",n.fillOpacity=e.fillOpacity||t.fillOpacity||1,n.weight=e.weight||t.weight||1,n.radius=e.radius||t.radius||6,n},_transformStyle:function(e){if(!e)return{};var t={};return t.color=this._hexToRgba(e.color,e.opacity),t.fillColor=this._hexToRgba(e.fillColor,e.fillOpacity),t.weight=e.weight,t.radius=e.radius,new ol.style.Style({stroke:new ol.style.Stroke({color:t.color,width:t.weight}),fill:new ol.style.Fill({color:t.fillColor}),image:new ol.style.Circle({radius:t.radius,stroke:new ol.style.Stroke({color:t.color,width:t.weight}),fill:new ol.style.Fill({color:t.fillColor})})})},_hexToRgba:function(e,t){var n=e;return e&&0===e.indexOf("#")&&(n=ol.color.asArray(n),n=n.slice(),n[3]=t,n=ol.color.asString(n)),n}}),t.locator.register("PublicaMundi.Helpers",t.OpenLayers.Helpers),t.helpers=function(){return t.locator.create("PublicaMundi.Helpers")})}(window,PublicaMundi),function(e,t,n){"undefined"!=typeof t&&"undefined"!=typeof n&&(t.define("PublicaMundi.OpenLayers.Layer"),t.OpenLayers.Layer.WMS=t.Class(t.Layer,{initialize:function(e){t.Layer.prototype.initialize.call(this,e),this._map=null,this._type=null,this._layer=new n.layer.Tile({title:e.title,visible:e.visible,source:new n.source.TileWMS({url:e.url,params:e.params})})},onLayerLoad:function(e){this._layer.on("change:visible",function(t){t.oldValue===!1&&e.call()})},fitToMap:function(){var e=this,n=this._options;if("undefined"!=typeof e._extent)e.getMap().setExtent(e._extent,"EPSG:4326");else if("undefined"!=typeof n.bbox)this._layer.once("postcompose",function(){e._extent=n.bbox,e.getMap().setExtent(e._extent,"EPSG:4326")});else{var r=t.parser(),i=n.url+"?service=WMS&request=GetCapabilities";$.ajax({url:i,success:function(t){var i=r.parseWMS(t),s=i.Layer;for(var o in s){var u=s[o];if(u.Name==n.params.layers)return e._extent=u.EX_GeographicBoundingBox,e._layer.once("postcompose",function(){e.getMap().setExtent(e._extent,"EPSG:4326")}),!1}}})}}}),t.registry.registerLayerType({layer:t.LayerType.WMS,framework:t.OpenLayers.Framework,type:"PublicaMundi.Layer.WMS",factory:t.OpenLayers.Layer.WMS}))}(window,window.PublicaMundi,ol),function(e,t,n){"undefined"!=typeof t&&"undefined"!=typeof n&&(t.define("PublicaMundi.OpenLayers.Layer"),t.OpenLayers.Layer.WFS=t.Class(t.Layer,{update:function(){},initialize:function(e){t.Layer.prototype.initialize.call(this,e),this._map=null,this._type=null,e.style=e.style||{normal:{},highlight:{}},e.style.normal=e.style.normal||{},e.style.highlight=e.style.highlight||{};var r=this._style.normal,i=t.helpers();t.isFunction(e.style.normal)?(this._style.normal=e.style.normal,r=this._style.normal):(this._style.normal=i._getDefaultStyle(e.style.normal,this._style.normal),r=i._transformStyle(this._style.normal)),t.isFunction(e.style.highlight)?this._style.highlight=e.style.highlight:this._style.highlight=i._getDefaultStyle(e.style.highlight,this._style.normal);var s,o=e.params.version,u=e.params.maxFeatures,a=e.params.format||"json";"gml"==a&&(a="gml2"),"json"==a?s=new n.format.GeoJSON:"gml32"==a||"gml31"==a||"gml3"==a?s=new n.format.WFS({gmlFormat:new n.format.GML3,extractAttributes:!0,resFactor:1}):"gml2"==a&&(s=new n.format.WFS({gmlFormat:new n.format.GML2}));var f=e.params.projection||"EPSG:3857";"EPSG:900913"==f?f="EPSG:3857":"EPSG:26713"==f&&(f="EPSG:3857");var l=e.params.layers,c=new n.source.Vector({format:s,projection:f,strategy:n.loadingstrategy.tile(new n.tilegrid.XYZ({})),loader:function(t,n,r){$.ajax({type:"GET",url:e.url,data:{service:"WFS",request:"GetFeature",typename:l,srsname:f,outputFormat:a,bbox:t.join(",")+",EPSG:3857",maxFeatures:u,version:o},async:!0,beforeSend:function(){},complete:function(){},success:function(e){h(e),$.event.trigger({type:"layerLoaded"})},failure:function(e){console.log("response"),console.log(e)}})}}),h=function(e){c.addFeatures(s.readFeatures(e))};this._layer=new n.layer.Vector({title:e.title,source:c,visible:e.visible,projection:f,style:r})},fitToMap:function(){var e=this,n=this._options;if("undefined"!=typeof n.bbox)this._layer.once("postcompose",function(){e.getMap().setExtent(e._extent,"EPSG:4326")});else{var r=t.parser(),i=n.url+"?service=WFS&request=GetCapabilities";$.ajax({url:i,success:function(t){var i=r.parseWFS(t),s=i.Layer;for(var o in s){var u=s[o];if(u.Name==n.params.layers)return e._extent=u.WGS84BoundingBox,e._layer.once("postcompose",function(){e.getMap().setExtent(e._extent,"EPSG:4326")}),!1}}})}}}),t.registry.registerLayerType({layer:t.LayerType.WFS,framework:t.OpenLayers.Framework,type:"PublicaMundi.Layer.WFS",factory:t.OpenLayers.Layer.WFS}))}(window,window.PublicaMundi,ol),function(e,t,n){"undefined"!=typeof t&&"undefined"!=typeof n&&(t.define("PublicaMundi.OpenLayers.Layer"),t.OpenLayers.Layer.Tile=t.Class(t.Layer,{initialize:function(e){t.Layer.prototype.initialize.call(this,e);var r=[];if(e.url.indexOf("{s}")<0)r.push(e.url);else{var i=e.subdomains||"abc";t.isArray(i)||(i=i.split(""));for(var s=0;s<i.length;s++)r.push(e.url.replace("{s}",i[s]))}this._layer=new n.layer.Tile({title:e.title,type:"base",source:new n.source.XYZ({urls:r})})}}),t.registry.registerLayerType({layer:t.LayerType.TILE,framework:t.OpenLayers.Framework,type:"PublicaMundi.Layer.Tile",factory:t.OpenLayers.Layer.Tile}))}(window,window.PublicaMundi,ol),function(e,t,n){"undefined"!=typeof t&&"undefined"!=typeof n&&(t.define("PublicaMundi.OpenLayers.Layer"),t.OpenLayers.Layer.KML=t.Class(t.Layer,{initialize:function(e){t.Layer.prototype.initialize.call(this,e),e.style=e.style||{normal:{},highlight:{}},e.style.normal=e.style.normal||{},e.style.highlight=e.style.highlight||{};var r=this._style.normal,i=t.helpers();t.isFunction(e.style.normal)?(this._style.normal=e.style.normal,r=this._style.normal):(this._style.normal=i._getDefaultStyle(e.style.normal,this._style.normal),r=i._transformStyle(this._style.normal)),t.isFunction(e.style.highlight)?this._style.highlight=e.style.highlight:this._style.highlight=i._getDefaultStyle(e.style.highlight,this._style.normal),this._layer=new n.layer.Vector({title:e.title,visible:e.visible,source:new n.source.Vector({projection:e.projection,format:new n.format.KML({extractStyles:!1}),url:e.url}),style:r})},fitToMap:function(){var e=this;this._layer.once("postcompose",function(){e._extent=this.getSource().getExtent(),e.getMap().setExtent(e._extent,"EPSG:3857")})}}),t.registry.registerLayerType({layer:t.LayerType.KML,framework:t.OpenLayers.Framework,type:"PublicaMundi.Layer.KML",factory:t.OpenLayers.Layer.KML}),t.isDefined(t.Map)&&(t.Map.prototype.KML=function(e){return e.type=t.LayerType.KML,this.createLayer(e)}))}(window,window.PublicaMundi,ol),function(e,t,n){"undefined"!=typeof t&&"undefined"!=typeof n&&(t.define("PublicaMundi.OpenLayers.Layer"),t.OpenLayers.Layer.GeoJson=t.Class(t.Layer,{initialize:function(e){t.Layer.prototype.initialize.call(this,e),e.style=e.style||{normal:{},highlight:{}},e.style.normal=e.style.normal||{},e.style.highlight=e.style.highlight||{};var r=this._style.normal,i=t.helpers();t.isFunction(e.style.normal)?(this._style.normal=e.style.normal,r=this._style.normal):(this._style.normal=i._getDefaultStyle(e.style.normal,this._style.normal),r=i._transformStyle(this._style.normal)),t.isFunction(e.style.highlight)?this._style.highlight=e.style.highlight:this._style.highlight=i._getDefaultStyle(e.style.highlight,this._style.normal);var s=null;if(e.url)s=new n.source.Vector({projection:e.projection,url:e.url});else if(e.text){var o=new n.format.GeoJSON,u=o.readFeatures(JSON.parse(e.text),{dataProjection:e.projection,featureProjection:t.Maps.CRS.Mercator});s=new n.source.GeoJSON({projection:e.projection}),s.addFeatures(u)}else if(e.data){var o=new n.format.GeoJSON,u=o.readFeatures(e.data,{dataProjection:e.projection,featureProjection:"EPSG:3857"});s=new n.source.Vector({projection:e.projection}),s.addFeatures(u)}this._layer=new n.layer.Vector({title:e.title,visible:e.visible,source:s,style:r})},fitToMap:function(){var e=this;this._layer.once("postcompose",function(){e._extent=this.getSource().getExtent(),e.getMap().setExtent(e._extent,"EPSG:3857")})}}),t.registry.registerLayerType({layer:t.LayerType.GeoJSON,framework:t.OpenLayers.Framework,type:"PublicaMundi.Layer.GeoJson",factory:t.OpenLayers.Layer.GeoJson}),t.isDefined(t.Map)&&(t.Map.prototype.geoJSON=function(e){return e.type=t.LayerType.GeoJSON,this.createLayer(e)}))}(window,window.PublicaMundi,ol);