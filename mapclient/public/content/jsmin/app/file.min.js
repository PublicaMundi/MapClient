define(["jquery","ol","URIjs/URI","shared"],function(e,t,n,r){return r.Maps.Resources.Types.KML=r.Maps.Resources.Types.KML||"KML",r.Maps.Resources.Types.GML=r.Maps.Resources.Types.GML||"GML",r.Maps.Resources.Types.GEOJSON=r.Maps.Resources.Types.GEOJSON||"GEOJSON",r.Maps.Resources.FileMetadataReader=r.Class(r.Maps.Resources.ResourceMetadataReader,{initialize:function(e){"function"==typeof r.Maps.Resources.ResourceMetadataReader.prototype.initialize&&r.Maps.Resources.ResourceMetadataReader.prototype.initialize.apply(this,arguments),this.values.type=e.type},getMetadata:function(e){var t=this;if(e=e||{url:null,text:null,filename:null,title:null,projection:null},e.projection=e.projection||r.Maps.CRS.WGS84,this.values.type==r.Maps.Resources.Types.KML&&(e.projection=r.Maps.CRS.WGS84),!e.url&&!e.filename)throw"One of parameters url or filename is required.";return new Promise(function(n,r){var i={type:t.values.type,key:e.url||e.filename,title:e.title||e.filename||e.url.replace(/^.*[\\\/]/,""),url:e.url,text:e.text,projection:e.projection,layers:[{key:e.url||e.filename,title:e.title||e.filename||e.url.replace(/^.*[\\\/]/,""),legend:null}]};n(i)})}}),r.Maps.Resources.KmlMetadataReader=r.Class(r.Maps.Resources.FileMetadataReader,{initialize:function(e){"function"==typeof r.Maps.Resources.ResourceMetadataReader.prototype.initialize&&r.Maps.Resources.ResourceMetadataReader.prototype.initialize.apply(this,arguments),this.values.type=r.Maps.Resources.Types.KML}}),r.Maps.Resources.GmlMetadataReader=r.Class(r.Maps.Resources.FileMetadataReader,{initialize:function(e){"function"==typeof r.Maps.Resources.ResourceMetadataReader.prototype.initialize&&r.Maps.Resources.ResourceMetadataReader.prototype.initialize.apply(this,arguments),this.values.type=r.Maps.Resources.Types.GML}}),r.Maps.Resources.GeoJSONMetadataReader=r.Class(r.Maps.Resources.FileMetadataReader,{initialize:function(e){"function"==typeof r.Maps.Resources.ResourceMetadataReader.prototype.initialize&&r.Maps.Resources.ResourceMetadataReader.prototype.initialize.apply(this,arguments),this.values.type=r.Maps.Resources.Types.GEOJSON}}),r.Maps.Resources.FileCkanResourceMetadataReaderAdapter=r.Class(r.Maps.Resources.CkanResourceMetadataReaderAdapter,{initialize:function(e){r.extend(this.values,e)},setOptions:function(e){if(e.metadata=null,e.format)switch(e.metadata={type:null,parameters:{url:e.url},extras:{}},e.format.toUpperCase()){case"KML":e.metadata.type=r.Maps.Resources.Types.KML;break;case"GML":e.metadata.type=r.Maps.Resources.Types.GML;break;case"GEOJSON":e.metadata.type=r.Maps.Resources.Types.GEOJSON}return e}}),r.Maps.Resources.FileLayerFactory=r.Class(r.Maps.Resources.LayerFactory,{initialize:function(e){"function"==typeof r.Maps.Resources.LayerFactory.prototype.initialize&&r.Maps.Resources.LayerFactory.prototype.initialize.apply(this,arguments)},create:function(e,n,i,s){var o=null,u=null,a=null;switch(n.type.toUpperCase()){case r.Maps.Resources.Types.KML:a=new t.format.KML;break;case r.Maps.Resources.Types.GML:a=new t.format.GML;break;case r.Maps.Resources.Types.GEOJSON:a=new t.format.GeoJSON({defaultDataProjection:"EPSG:3857"})}var f=[new t.style.Style({fill:new t.style.Fill({color:[255,0,0,.4]}),stroke:new t.style.Stroke({color:"#ff0000",width:2})}),new t.style.Style({image:new t.style.Circle({radius:6,fill:new t.style.Fill({color:[255,0,0,.4]}),stroke:new t.style.Stroke({color:"#ff0000",width:2})}),zIndex:1/0})];if(n.url)u=new t.source.Vector({projection:r.Maps.CRS.Mercator,url:n.url,format:a,useSpatialIndex:!0}),o=new t.layer.Vector({source:u,style:f});else if(n.text){u=new t.source.Vector({projection:r.Maps.CRS.Mercator,format:a,useSpatialIndex:!0});var l=a.readFeatures(n.text,{dataProjection:n.projection,featureProjection:r.Maps.CRS.Mercator});n.type.toUpperCase()==r.Maps.Resources.Types.GML&&l.length>0&&(!l[0].getGeometry()||0===l[0].getGeometry().getCoordinates().length)&&(a=new t.format.GML2,l=a.readFeatures(n.text,{dataProjection:n.projection,featureProjection:r.Maps.CRS.Mercator})),u.addFeatures(l),o=new t.layer.Vector({source:u,style:f})}var c=function(e,n){for(var r=t.extent.createEmpty(),i=n.getFeatures(),s=0;s<i.length;s++){var o=i[s].getGeometry();o&&t.extent.extend(r,o.getExtent())}e.getView().fitExtent(r,e.getSize())};if(o)if(e.addLayer(o),n.url)var h=u.on("change",function(n){"ready"==u.getState()&&(t.Observable.unByKey(h),c(e,u))});else c(e,u);return o}}),r.Maps.Resources.registerResourceType(r.Maps.Resources.Types.KML,"KML",r.Maps.Resources.KmlMetadataReader,r.Maps.Resources.FileLayerFactory),r.Maps.Resources.registerResourceType(r.Maps.Resources.Types.GML,"GML",r.Maps.Resources.GmlMetadataReader,r.Maps.Resources.FileLayerFactory),r.Maps.Resources.registerResourceType(r.Maps.Resources.Types.GEOJSON,"GEOJSON",r.Maps.Resources.GeoJSONMetadataReader,r.Maps.Resources.FileLayerFactory),r.Maps.Resources.registerResourceTypeAdapter("KML",r.Maps.Resources.Types.KML,r.Maps.Resources.FileCkanResourceMetadataReaderAdapter),r.Maps.Resources.registerResourceTypeAdapter("GML",r.Maps.Resources.Types.GML,r.Maps.Resources.FileCkanResourceMetadataReaderAdapter),r.Maps.Resources.registerResourceTypeAdapter("GEOJSON",r.Maps.Resources.Types.GEOJSON,r.Maps.Resources.FileCkanResourceMetadataReaderAdapter),r});