/* PublicaMundi Map Client version 1.0.0 2015-11-27 */

define(["jquery","ol","URIjs/URI","shared"],function(a,b,c,d){return d.Maps.Resources.Types.KML=d.Maps.Resources.Types.KML||"KML",d.Maps.Resources.Types.GML=d.Maps.Resources.Types.GML||"GML",d.Maps.Resources.Types.GEOJSON=d.Maps.Resources.Types.GEOJSON||"GEOJSON",d.Maps.Resources.FileMetadataReader=d.Class(d.Maps.Resources.ResourceMetadataReader,{initialize:function(a){"function"==typeof d.Maps.Resources.ResourceMetadataReader.prototype.initialize&&d.Maps.Resources.ResourceMetadataReader.prototype.initialize.apply(this,arguments),this.values.type=a.type},getMetadata:function(a){var b=this;if(a=a||{url:null,text:null,filename:null,title:null,projection:null},a.projection=a.projection||d.Maps.CRS.WGS84,this.values.type==d.Maps.Resources.Types.KML&&(a.projection=d.Maps.CRS.WGS84),!a.url&&!a.filename)throw"One of parameters url or filename is required.";return new Promise(function(c,d){var e={type:b.values.type,key:a.url||a.filename,title:a.title||a.filename||a.url.replace(/^.*[\\\/]/,""),url:a.url,text:a.text,projection:a.projection,layers:[{key:a.url||a.filename,title:a.title||a.filename||a.url.replace(/^.*[\\\/]/,""),legend:null}]};c(e)})}}),d.Maps.Resources.KmlMetadataReader=d.Class(d.Maps.Resources.FileMetadataReader,{initialize:function(a){"function"==typeof d.Maps.Resources.ResourceMetadataReader.prototype.initialize&&d.Maps.Resources.ResourceMetadataReader.prototype.initialize.apply(this,arguments),this.values.type=d.Maps.Resources.Types.KML}}),d.Maps.Resources.GmlMetadataReader=d.Class(d.Maps.Resources.FileMetadataReader,{initialize:function(a){"function"==typeof d.Maps.Resources.ResourceMetadataReader.prototype.initialize&&d.Maps.Resources.ResourceMetadataReader.prototype.initialize.apply(this,arguments),this.values.type=d.Maps.Resources.Types.GML}}),d.Maps.Resources.GeoJSONMetadataReader=d.Class(d.Maps.Resources.FileMetadataReader,{initialize:function(a){"function"==typeof d.Maps.Resources.ResourceMetadataReader.prototype.initialize&&d.Maps.Resources.ResourceMetadataReader.prototype.initialize.apply(this,arguments),this.values.type=d.Maps.Resources.Types.GEOJSON}}),d.Maps.Resources.FileCkanResourceMetadataReaderAdapter=d.Class(d.Maps.Resources.CkanResourceMetadataReaderAdapter,{initialize:function(a){d.extend(this.values,a)},setOptions:function(a){if(a.metadata=null,a.format)switch(a.metadata={type:null,parameters:{url:a.url},extras:{}},a.format.toUpperCase()){case"KML":a.metadata.type=d.Maps.Resources.Types.KML;break;case"GML":a.metadata.type=d.Maps.Resources.Types.GML;break;case"GEOJSON":a.metadata.type=d.Maps.Resources.Types.GEOJSON}return a}}),d.Maps.Resources.FileLayerFactory=d.Class(d.Maps.Resources.LayerFactory,{initialize:function(a){"function"==typeof d.Maps.Resources.LayerFactory.prototype.initialize&&d.Maps.Resources.LayerFactory.prototype.initialize.apply(this,arguments)},create:function(a,c,e,f){var g=null,h=null,i=null;switch(c.type.toUpperCase()){case d.Maps.Resources.Types.KML:i=new b.format.KML;break;case d.Maps.Resources.Types.GML:i=new b.format.GML;break;case d.Maps.Resources.Types.GEOJSON:i=new b.format.GeoJSON({defaultDataProjection:"EPSG:3857"})}var j=[new b.style.Style({fill:new b.style.Fill({color:[255,0,0,.4]}),stroke:new b.style.Stroke({color:"#ff0000",width:2})}),new b.style.Style({image:new b.style.Circle({radius:6,fill:new b.style.Fill({color:[255,0,0,.4]}),stroke:new b.style.Stroke({color:"#ff0000",width:2})}),zIndex:1/0})];if(c.url)h=new b.source.Vector({projection:d.Maps.CRS.Mercator,url:c.url,format:i,useSpatialIndex:!0}),g=new b.layer.Vector({source:h,style:j});else if(c.text){h=new b.source.Vector({projection:d.Maps.CRS.Mercator,format:i,useSpatialIndex:!0});var k=i.readFeatures(c.text,{dataProjection:c.projection,featureProjection:d.Maps.CRS.Mercator});c.type.toUpperCase()==d.Maps.Resources.Types.GML&&k.length>0&&(!k[0].getGeometry()||0===k[0].getGeometry().getCoordinates().length)&&(i=new b.format.GML2,k=i.readFeatures(c.text,{dataProjection:c.projection,featureProjection:d.Maps.CRS.Mercator})),h.addFeatures(k),g=new b.layer.Vector({source:h,style:j})}var l=function(a,c){for(var d=b.extent.createEmpty(),e=c.getFeatures(),f=0;f<e.length;f++){var g=e[f].getGeometry();g&&b.extent.extend(d,g.getExtent())}a.getView().fitExtent(d,a.getSize())};if(g)if(a.addLayer(g),c.url)var m=h.on("change",function(c){"ready"==h.getState()&&(b.Observable.unByKey(m),l(a,h))});else l(a,h);return g}}),d.Maps.Resources.registerResourceType(d.Maps.Resources.Types.KML,"KML",d.Maps.Resources.KmlMetadataReader,d.Maps.Resources.FileLayerFactory),d.Maps.Resources.registerResourceType(d.Maps.Resources.Types.GML,"GML",d.Maps.Resources.GmlMetadataReader,d.Maps.Resources.FileLayerFactory),d.Maps.Resources.registerResourceType(d.Maps.Resources.Types.GEOJSON,"GEOJSON",d.Maps.Resources.GeoJSONMetadataReader,d.Maps.Resources.FileLayerFactory),d.Maps.Resources.registerResourceTypeAdapter("KML",d.Maps.Resources.Types.KML,d.Maps.Resources.FileCkanResourceMetadataReaderAdapter),d.Maps.Resources.registerResourceTypeAdapter("GML",d.Maps.Resources.Types.GML,d.Maps.Resources.FileCkanResourceMetadataReaderAdapter),d.Maps.Resources.registerResourceTypeAdapter("GEOJSON",d.Maps.Resources.Types.GEOJSON,d.Maps.Resources.FileCkanResourceMetadataReaderAdapter),d});
//# sourceMappingURL=file.min.js.map